DROP DATABASE IF EXISTS SaleCo;

CREATE DATABASE SaleCo;
USE SaleCo;

#Customer
CREATE TABLE Customer (
    CUS_CODE INT(5),
    CUS_LNAME VARCHAR(20),
    CUS_FNAME VARCHAR(20),
    CUS_INITIAL CHAR(1),
    CUS_AREACODE CHAR(4),
    CUS_PHONE CHAR(8),
    CUS_BALANCE DOUBLE(5,2)
);

#Invoice
CREATE TABLE Invoice (
	INV_NUMBER INT(4),
    CUS_CODE INT(5),
    INV_DATE DATE
);

#Line
CREATE TABLE Line (
    LINE_NUMBER INT,
	INV_NUMBER INT(4),
    PROD_CODE CHAR(8),
    LINE_UNITS INT,
    LINE_PRICE DOUBLE(5,2)
);

#Product
CREATE TABLE Product (
	PROD_CODE CHAR(8),
    PROD_DESCRIPT LONGTEXT,
    PROD_START_SALE_DATE DATE,
    PROD_ON_HAND INT,
    PROD_PRICE DOUBLE(5,2),
    PROD_SALE DOUBLE(5,2),
    VEND_CODE INT(5)
);

#Vendor
CREATE TABLE Vendor (
	VEND_CODE INT(5),
    VEND_NAME VARCHAR(30),
    VEND_CONTACT VARCHAR(20),
    VEND_AREACODE CHAR(4),
    VEND_PHONE CHAR(8),
    VEND_COUNTRY CHAR(2)
);

#Bæta við keys
ALTER TABLE Customer ADD PRIMARY KEY(CUS_CODE);
ALTER TABLE Invoice ADD PRIMARY KEY(INV_NUMBER);
ALTER TABLE Line ADD PRIMARY KEY(LINE_NUMBER);
ALTER TABLE Product ADD PRIMARY KEY(PROD_CODE);
ALTER TABLE Vendor ADD PRIMARY KEY(VEND_CODE);

#Bæta við forign keys
ALTER TABLE Invoice ADD CONSTRAINT CUS_CODE_FK FOREIGN KEY (CUS_CODE) REFERENCES Customer(CUS_CODE) ON UPDATE CASCADE;
ALTER TABLE Line ADD CONSTRAINT INV_NUMBER_FK FOREIGN KEY (INV_NUMBER) REFERENCES Invoice(INV_NUMBER) ON DELETE CASCADE;
ALTER TABLE Line ADD CONSTRAINT PROD_CODE_FK FOREIGN KEY (PROD_CODE) REFERENCES Product(PROD_CODE);# ON DELETE SET NULL; # This makes a 1064 error: You have an error in your SQL syntax;
ALTER TABLE Product ADD CONSTRAINT VEND_CODE_FK FOREIGN KEY (VEND_CODE) REFERENCES Vendor(VEND_CODE);

#Setja default value
ALTER TABLE Customer MODIFY COLUMN CUS_BALANCE DOUBLE(5,2) DEFAULT 0.00;
ALTER TABLE Customer MODIFY COLUMN CUS_AREACODE CHAR(4) DEFAULT "0181";
ALTER TABLE Line MODIFY COLUMN LINE_UNITS INT DEFAULT 0;
ALTER TABLE Line MODIFY COLUMN LINE_PRICE DOUBLE(5,2) DEFAULT 0.00;

#Insert Into Tables

#CUSTOMER rows
INSERT INTO
	Customer(CUS_CODE,CUS_LNAME,CUS_FNAME,CUS_INITIAL,CUS_AREACODE,CUS_PHONE,CUS_BALANCE)
VALUES
	(10010,'Ramas','Alfred','A','0181','844-2573',0),
	(10011,'Dunne','Leona','K','0161','894-1238',0),
	(10012,'Smith','Kathy','W','0181','894-2285',345.86);

#INVOICE rows
INSERT INTO
	Invoice(INV_NUMBER,CUS_CODE,INV_DATE)
VALUES
	(1001,10010,'2008-01-16'),
	(1002,10011,'2008-01-16'),
	(1003,10012,'2008-01-16');
    
#VENDOR rows
INSERT INTO
	Vendor(VEND_CODE,VEND_NAME,VEND_CONTACT,VEND_AREACODE,VEND_PHONE,VEND_COUNTRY)
VALUES
	(21225,'Bryson, Inc.','Smithson','0181','223-3234','UK'),
	(21226,'SuperLoo, Inc.','Flushing','0113','215-8995','SA'),
	(21231,'D\&E Supply','Singh','0181','228-3245','UK');

#PRODUCT rows
INSERT INTO
	Product(PROD_CODE,PROD_DESCRIPT,PROD_START_SALE_DATE,PROD_ON_HAND,PROD_PRICE,PROD_SALE,VEND_CODE)
VALUES
	('11QER/31','Power painter, 15 psi., 3-nozzle','2007-11-07',8, 109.99,0.00,21225),
	('13-Q2/P2','7.25-cm. pwr. saw blade','2007-12-14', 32, 14.99,0.05,21226),
	('14-Q1/L3','9.00-cm. pwr. saw blade','2007-11-13', 18, 17.49,0.00,21231);


#LINE rows	
INSERT INTO
	Line(INV_NUMBER,LINE_NUMBER,PROD_CODE,LINE_UNITS,LINE_PRICE)
VALUES
	(1001,1,'11QER/31',1,14.99),
	(1002,2,'13-Q2/P2',1,9.95),
	(1003,3,'14-Q1/L3',2,4.99);

CREATE TABLE Employees (
    EMP_NUM INT PRIMARY KEY,
    EMP_TITLE CHAR(10), 
    EMP_LNAME VARCHAR(15), 
    EMP_FNAME VARCHAR(15), 
    EMP_INITIAL CHAR(1), 
    EMP_DOB DATETIME, 
    EMP_HIR_DATE DATETIME, 
    EMP_AREACODE CHAR(5), 
    EMP_PHONE CHAR(8), 
    EMP_MGR INT
);
